<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Todo App</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #f8f9fa;
            padding-top: 50px;
        }
        .container {
            max-width: 600px;
        }
        #errorModal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            justify-content: center;
            align-items: center;
        }
        .modal-content {
            background-color: white;
            padding: 20px;
            border-radius: 5px;
            width: 80%;
            max-width: 400px;
        }
        .modal-header {
            font-size: 18px;
            font-weight: bold;
        }
    </style>
</head>
<body>

    <div class="container">
        <h1 class="text-center">Todo List</h1>
        
        <form id="todoForm">
            <div class="mb-3">
                <label for="title" class="form-label">Title</label>
                <input type="text" id="title" class="form-control" placeholder="Title" required />
            </div>
            <div class="mb-3">
                <label for="description" class="form-label">Description</label>
                <input type="text" id="description" class="form-control" placeholder="Description" required />
            </div>
            <div class="mb-3">
                <label for="priority" class="form-label">Priority</label>
                <input type="number" id="priority" class="form-control" placeholder="Priority" required />
            </div>
            <div class="mb-3">
                <label for="dueDate" class="form-label">Due Date</label>
                <input type="date" id="dueDate" class="form-control" placeholder="Due Date" required />
            </div>
            <button type="button" class="btn btn-primary w-100" onclick="submitTodo()">Add Todo</button>
        </form>

        <div id="errorModal" class="d-flex">
            <div class="modal-content">
                <div class="modal-header">
                    <h5>Error</h5>
                </div>
                <p id="errorMessage"></p>
                <button class="btn btn-danger" onclick="closeModal()">Close</button>
            </div>
        </div>
    </div>

    <script>
        const apiUrl = 'http://localhost:8080/todo_backend_servlet_war_exploded/api/todos';

        async function submitTodo() {
            const title = document.getElementById('title').value;
            const description = document.getElementById('description').value;
            const priority = document.getElementById('priority').value;
            const dueDate = document.getElementById('dueDate').value;

            if (!title || !description || !priority || !dueDate) {
                showModalError('All fields are required!');
                return;
            }

            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ title, description, priority, dueDate, status: false }),
                    mode: 'cors'
                });

                if (!response.ok) {
                    const errorResponse = await response.json();
                    throw new Error(errorResponse.message || 'Failed to add Todo');
                }

                console.log('Todo added successfully');
                fetchTodos();
                closeModal();
            } catch (error) {
                console.error('Error submitting todo:', error);
                showModalError(error.message || 'Failed to add Todo. Please try again later.');
            }
        }

        function showModalError(message) {
            const modal = document.getElementById('errorModal');
            const messageElement = document.getElementById('errorMessage');
            messageElement.textContent = message;
            modal.style.display = 'flex';
        }

        function closeModal() {
            const modal = document.getElementById('errorModal');
            modal.style.display = 'none';
        }

        async function fetchTodos() {
            try {
                const response = await fetch(apiUrl, { mode: 'cors' });

                if (!response.ok) {
                    const errorResponse = await response.json();
                    throw new Error(errorResponse.message || 'Failed to fetch todos');
                }

                const todos = await response.json();
                console.log('Todos fetched successfully', todos);
            } catch (error) {
                console.error('Error fetching todos:', error);
            }
        }

        fetchTodos();
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
